<?xml version="1.0" encoding="UTF-8"?>
<TestScript xmlns="http://hl7.org/fhir">
    <id value="medmij-bgzl-xis-1-1"/>
    <url value="http://nictiz.nl/fhir/TestScript/medmij-bgzl-xis-1-1"/>
    <version value="stu3-1.0.1"/>
    <name value="Nictiz MedMij BgZL - XIS Client - Scenario 1.1 - Serve BgLZ person 1 at XIS 1"/>
    <status value="active"/>
    <date value="2021-02-11"/>
    <publisher value="Nictiz"/>
    <contact>
        <name value="Nictiz"/>
        <telecom>
            <system value="email"/>
            <value value="kwalificatie@nictiz.nl"/>
            <use value="work"/>
        </telecom>
    </contact>
    <description value="MedMij BgZL for FHIR STU3 - Scenario 1.1 - Serve BgLZ person 1 at XIS 1"/>
    <copyright value="Â© Nictiz 2019"/>
    <origin>
        <index value="1"/>
        <profile>
            <system value="http://hl7.org/fhir/testscript-profile-origin-types"/>
            <code value="FHIR-Client"/>
        </profile>
    </origin>
    <destination>
        <index value="1"/>
        <profile>
            <system value="http://hl7.org/fhir/testscript-profile-destination-types"/>
            <code value="FHIR-Server"/>
        </profile>
    </destination>
    <fixture id="patient-fixture">
        <resource>
            <reference value="../_reference/resources/bglz-1-1-Patient-01.xml"/>
        </resource>
    </fixture>
    <fixture id="patient-token-fixture">
        <resource>
            <reference value="../_reference/bglz-nl-core-patient-XXX-Mutter-token.xml"/>
        </resource>
    </fixture>
    <profile id="Bundle-profile">
        <reference value="http://hl7.org/fhir/StructureDefinition/Bundle"/>
    </profile>
    <variable>
        <name value="patient-id"/>
        <expression value="Patient.id"/>
        <sourceId value="patient-fixture"/>
    </variable>
    <variable>
        <name value="patient-token-id"/>
        <expression value="Patient.id"/>
        <sourceId value="patient-token-fixture"/>
    </variable>
    <variable>
        <name value="token-XXX-Mutter"/>
        <defaultValue value="Bearer ce28d649-a3ba-4d9c-99e6-d31f6a70476f"/>
        <!--<defaultValue value="${patient1-token-id}"/>-->
        <description value="OAuth Token for patient XXX_Mutter"/>
    </variable>
    <!-- No Setup -->
    <test id="01-ServeBgZL-Patient">
        <name value="01-ServeBgZL-Patient"/>
        <description value="Test XIS Client search operation  - Serve Patient and include Practitioner/Organization resource"/>
        <action>
            <operation>
                <type>
                    <system value="http://hl7.org/fhir/testscript-operation-codes"/>
                    <code value="search"/>
                </type>
                <resource value="Patient"/>
                <description value="Test XIS client retrieve search operation  - Serve Patient and include Practitioner/Organization resource"/>
                <accept value="xml"/>
                <contentType value="none"/>
                <destination value="1"/>
                <origin value="1"/>
                <params value="?_include=Patient:general-practitioner"/>
                <requestHeader>
                    <field value="Authorization"/>
                    <value value="${token-XXX-Mutter}"/>
                    </requestHeader>
            </operation>
        </action>
        <action>
            <assert>
                <description value="Confirm that the client did not request a Content-Type. Warning only to allow for systems that automatically send Content-Type."/>
                <direction value="request"/>
                <headerField value="Content-Type"/>
                <operator value="empty"/>
                <warningOnly value="true"/>
            </assert>
        </action>
        <action>
            <assert>
                <description value="Confirm that HTTP header Authorization contains the patient token ${token-XXX-Mutter}"/>
                <direction value="request"/>
                <headerField value="Authorization"/>
                <value value="${token-XXX-Mutter}"/>
            </assert>
        </action>
        <action>
            <assert>
                <description value="Confirm that the returned HTTP status is 200(OK)."/>
                <direction value="response"/>
                <responseCode value="200"/>
            </assert>
        </action>
        <action>
            <assert>
                <description value="Confirm that the returned resource type is Bundle."/>
                <direction value="response"/>
                <resource value="Bundle"/>
            </assert>
        </action>
        <action>
            <assert>
                <description value="Confirm that the returned Bundle conforms to the base FHIR specification."/>
                <direction value="response"/>
                <validateProfileId value="Bundle-profile"/>
            </assert>
        </action>
        <action>
            <assert>
                <description value="Confirm that the returned Bundle total value matches or is less than the number of entries in the Bundle. The included resources should not be counted as entries in the .total."/>
                <direction value="response"/>
                <expression value="Bundle.total.toInteger() &lt;= Bundle.entry.where(search.empty() or search.mode = 'match').count()"/>
            </assert>
        </action>
        <action>
            <assert>
                <description value="Confirm that the returned searchset Bundle is empty, or contains an OperationOutcome as first resource or contains 1 Patient and 1 Practitioner entry."/>
                <direction value="response"/>
                <expression value="Bundle.where(entry.empty() or entry[0].resource.is(OperationOutcome) or entry.where(resource.is(Patient) or resource.is(Practitioner)).count() = 2).exists()"/>
            </assert>
        </action>
    </test>
    <test id="02-ServeBgZL-TreatmentDirective">
        <name value="02-ServeBgZL-TreatmentDirective"/>
        <description value="Test XIS Client search operation  - Serve HCIM TreatmentDirective"/>
        <action>
            <operation>
                <type>
                    <system value="http://hl7.org/fhir/testscript-operation-codes"/>
                    <code value="search"/>
                </type>
                <resource value="Consent"/>
                <description value="Test XIS Client search operation  - Serve HCIM TreatmentDirective"/>
                <accept value="xml"/>
                <contentType value="none"/>
                <destination value="1"/>
                <origin value="1"/>
                <params value="?category=http://snomed.info/sct|11291000146105"/>
                <requestHeader>
                    <field value="Authorization"/>
                    <value value="${token-XXX-Mutter}"/>
                </requestHeader>
            </operation>
        </action>
        <action>
            <assert>
                <description value="Confirm that the client did not request a Content-Type. Warning only to allow for systems that automatically send Content-Type."/>
                <direction value="request"/>
                <headerField value="Content-Type"/>
                <operator value="empty"/>
                <warningOnly value="true"/>
            </assert>
        </action>
        <action>
            <assert>
                <description value="Confirm that HTTP header Authorization contains the patient token ${token-XXX-Mutter}"/>
                <direction value="request"/>
                <headerField value="Authorization"/>
                <value value="${token-XXX-Mutter}"/>
            </assert>
        </action>
        <action>
            <assert>
                <description value="Confirm that query parameter 'patient=' was not present to avoid BSNs in the URL."/>
                <direction value="request"/>
                <operator value="notContains"/>
                <requestURL value="patient="/>
            </assert>
        </action>
        <action>
            <assert>
                <description value="Confirm that query parameter 'subject=' was not present to avoid BSNs in the URL."/>
                <direction value="request"/>
                <operator value="notContains"/>
                <requestURL value="subject="/>
            </assert>
        </action>
        <action>
            <assert>
                <description value="Confirm that the returned HTTP status is 200(OK)."/>
                <direction value="response"/>
                <responseCode value="200"/>
            </assert>
        </action>
        <action>
            <assert>
                <description value="Confirm that the returned resource type is Bundle."/>
                <direction value="response"/>
                <resource value="Bundle"/>
            </assert>
        </action>
        <action>
            <assert>
                <description value="Confirm that the returned Bundle conforms to the base FHIR specification."/>
                <direction value="response"/>
                <validateProfileId value="Bundle-profile"/>
            </assert>
        </action>
        <action>
            <assert>
                <description value="Confirm that the returned Bundle total value matches or is less than the number of entries in the Bundle. The included resources should not be counted as entries in the .total."/>
                <direction value="response"/>
                <expression value="Bundle.total.toInteger() &lt;= Bundle.entry.where(search.empty() or search.mode = 'match').count()"/>
            </assert>
        </action>
        <action>
            <assert>
                <description value="Confirm that the returned searchset Bundle is empty, or contains an OperationOutcome as first resource or contains 1 Consent entry."/>
                <direction value="response"/>
                <expression value="Bundle.where(entry.empty() or entry[0].resource.is(OperationOutcome) or entry.where(resource.is(Consent)).count() = 1).exists()"/>
            </assert>
        </action>
    </test>
    <test id="03-ServeBgZL-AdvanceDirective">
        <name value="03-ServeBgZL-AdvanceDirective"/>
        <description value="Test XIS Client search operation  - Serve HCIM AdvanceDirective"/>
        <action>
            <operation>
                <type>
                    <system value="http://hl7.org/fhir/testscript-operation-codes"/>
                    <code value="search"/>
                </type>
                <resource value="Consent"/>
                <description value="Test XIS Client search operation  - Serve HCIM AdvanceDirective"/>
                <accept value="xml"/>
                <contentType value="none"/>
                <destination value="1"/>
                <origin value="1"/>
                <params value="?category=http://snomed.info/sct|11341000146107"/>
                <requestHeader>
                    <field value="Authorization"/>
                    <value value="${token-XXX-Mutter}"/>
                </requestHeader>
            </operation>
        </action>
        <action>
            <assert>
                <description value="Confirm that the client did not request a Content-Type. Warning only to allow for systems that automatically send Content-Type."/>
                <direction value="request"/>
                <headerField value="Content-Type"/>
                <operator value="empty"/>
                <warningOnly value="true"/>
            </assert>
        </action>
        <action>
            <assert>
                <description value="Confirm that HTTP header Authorization contains the patient token ${token-XXX-Mutter}"/>
                <direction value="request"/>
                <headerField value="Authorization"/>
                <value value="${token-XXX-Mutter}"/>
            </assert>
        </action>
        <action>
            <assert>
                <description value="Confirm that query parameter 'patient=' was not present to avoid BSNs in the URL."/>
                <direction value="request"/>
                <operator value="notContains"/>
                <requestURL value="patient="/>
            </assert>
        </action>
        <action>
            <assert>
                <description value="Confirm that query parameter 'subject=' was not present to avoid BSNs in the URL."/>
                <direction value="request"/>
                <operator value="notContains"/>
                <requestURL value="subject="/>
            </assert>
        </action>
        <action>
            <assert>
                <description value="Confirm that the returned HTTP status is 200(OK)."/>
                <direction value="response"/>
                <responseCode value="200"/>
            </assert>
        </action>
        <action>
            <assert>
                <description value="Confirm that the returned resource type is Bundle."/>
                <direction value="response"/>
                <resource value="Bundle"/>
            </assert>
        </action>
        <action>
            <assert>
                <description value="Confirm that the returned Bundle conforms to the base FHIR specification."/>
                <direction value="response"/>
                <validateProfileId value="Bundle-profile"/>
            </assert>
        </action>
        <action>
            <assert>
                <description value="Confirm that the returned Bundle total value matches or is less than the number of entries in the Bundle. The included resources should not be counted as entries in the .total."/>
                <direction value="response"/>
                <expression value="Bundle.total.toInteger() &lt;= Bundle.entry.where(search.empty() or search.mode = 'match').count()"/>
            </assert>
        </action>
        <action>
            <assert>
                <description value="Confirm that the returned searchset Bundle is empty, or contains an OperationOutcome as first resource or contains 1 Consent entry."/>
                <direction value="response"/>
                <expression value="Bundle.where(entry.empty() or entry[0].resource.is(OperationOutcome) or entry.where(resource.is(Consent)).count() = 1).exists()"/>
            </assert>
        </action>
    </test>
    <test id="04-ServeBgZL-Problem">
        <name value="04-ServeBgZL-Problem"/>
        <description value="Test XIS Client search operation  - Serve HCIM Problem"/>
        <action>
            <operation>
                <type>
                    <system value="http://hl7.org/fhir/testscript-operation-codes"/>
                    <code value="search"/>
                </type>
                <resource value="Condition"/>
                <description value="Test XIS Client search operation  - Serve HCIM Problem"/>
                <accept value="xml"/>
                <contentType value="none"/>
                <destination value="1"/>
                <origin value="1"/>
                <requestHeader>
                    <field value="Authorization"/>
                    <value value="${token-XXX-Mutter}"/>
                </requestHeader>
            </operation>
        </action>
        <action>
            <assert>
                <description value="Confirm that the client did not request a Content-Type. Warning only to allow for systems that automatically send Content-Type."/>
                <direction value="request"/>
                <headerField value="Content-Type"/>
                <operator value="empty"/>
                <warningOnly value="true"/>
            </assert>
        </action>
        <action>
            <assert>
                <description value="Confirm that HTTP header Authorization contains the patient token ${token-XXX-Mutter}"/>
                <direction value="request"/>
                <headerField value="Authorization"/>
                <value value="${token-XXX-Mutter}"/>
            </assert>
        </action>
        <action>
            <assert>
                <description value="Confirm that query parameter 'patient=' was not present to avoid BSNs in the URL."/>
                <direction value="request"/>
                <operator value="notContains"/>
                <requestURL value="patient="/>
            </assert>
        </action>
        <action>
            <assert>
                <description value="Confirm that query parameter 'subject=' was not present to avoid BSNs in the URL."/>
                <direction value="request"/>
                <operator value="notContains"/>
                <requestURL value="subject="/>
            </assert>
        </action>
        <action>
            <assert>
                <description value="Confirm that the returned HTTP status is 200(OK)."/>
                <direction value="response"/>
                <responseCode value="200"/>
            </assert>
        </action>
        <action>
            <assert>
                <description value="Confirm that the returned resource type is Bundle."/>
                <direction value="response"/>
                <resource value="Bundle"/>
            </assert>
        </action>
        <action>
            <assert>
                <description value="Confirm that the returned Bundle conforms to the base FHIR specification."/>
                <direction value="response"/>
                <validateProfileId value="Bundle-profile"/>
            </assert>
        </action>
        <action>
            <assert>
                <description value="Confirm that the returned Bundle total value matches or is less than the number of entries in the Bundle. The included resources should not be counted as entries in the .total."/>
                <direction value="response"/>
                <expression value="Bundle.total.toInteger() &lt;= Bundle.entry.where(search.empty() or search.mode = 'match').count()"/>
            </assert>
        </action>
        <action>
            <assert>
                <description value="Confirm that the returned searchset Bundle is empty, or contains an OperationOutcome as first resource or contains 8 Condition entry."/>
                <direction value="response"/>
                <expression value="Bundle.where(entry.empty() or entry[0].resource.is(OperationOutcome) or entry.where(resource.is(Condition)).count() = 8).exists()"/>
            </assert>
        </action>
    </test>
    <test id="05-ServeBgZL-AllergyIntolerance">
        <name value="05-ServeBgZL-AllergyIntolerance"/>
        <description value="Test XIS Client search operation  - Serve HCIM AllergyIntolerance"/>
        <action>
            <operation>
                <type>
                    <system value="http://hl7.org/fhir/testscript-operation-codes"/>
                    <code value="search"/>
                </type>
                <resource value="AllergyIntolerance"/>
                <description value="Test XIS Client search operation  - Serve HCIM AllergyIntolerance"/>
                <accept value="xml"/>
                <contentType value="none"/>
                <destination value="1"/>
                <origin value="1"/>
                <requestHeader>
                    <field value="Authorization"/>
                    <value value="${token-XXX-Mutter}"/>
                </requestHeader>
            </operation>
        </action>
        <action>
            <assert>
                <description value="Confirm that the client did not request a Content-Type. Warning only to allow for systems that automatically send Content-Type."/>
                <direction value="request"/>
                <headerField value="Content-Type"/>
                <operator value="empty"/>
                <warningOnly value="true"/>
            </assert>
        </action>
        <action>
            <assert>
                <description value="Confirm that HTTP header Authorization contains the patient token ${token-XXX-Mutter}"/>
                <direction value="request"/>
                <headerField value="Authorization"/>
                <value value="${token-XXX-Mutter}"/>
            </assert>
        </action>
        <action>
            <assert>
                <description value="Confirm that query parameter 'patient=' was not present to avoid BSNs in the URL."/>
                <direction value="request"/>
                <operator value="notContains"/>
                <requestURL value="patient="/>
            </assert>
        </action>
        <action>
            <assert>
                <description value="Confirm that query parameter 'subject=' was not present to avoid BSNs in the URL."/>
                <direction value="request"/>
                <operator value="notContains"/>
                <requestURL value="subject="/>
            </assert>
        </action>
        <action>
            <assert>
                <description value="Confirm that the returned HTTP status is 200(OK)."/>
                <direction value="response"/>
                <responseCode value="200"/>
            </assert>
        </action>
        <action>
            <assert>
                <description value="Confirm that the returned resource type is Bundle."/>
                <direction value="response"/>
                <resource value="Bundle"/>
            </assert>
        </action>
        <action>
            <assert>
                <description value="Confirm that the returned Bundle conforms to the base FHIR specification."/>
                <direction value="response"/>
                <validateProfileId value="Bundle-profile"/>
            </assert>
        </action>
        <action>
            <assert>
                <description value="Confirm that the returned Bundle total value matches or is less than the number of entries in the Bundle. The included resources should not be counted as entries in the .total."/>
                <direction value="response"/>
                <expression value="Bundle.total.toInteger() &lt;= Bundle.entry.where(search.empty() or search.mode = 'match').count()"/>
            </assert>
        </action>
        <action>
            <assert>
                <description value="Confirm that the returned searchset Bundle is empty, or contains an OperationOutcome as first resource or contains 2 Condition entry."/>
                <direction value="response"/>
                <expression value="Bundle.where(entry.empty() or entry[0].resource.is(OperationOutcome) or entry.where(resource.is(AllergyIntolerance)).count() = 2).exists()"/>
            </assert>
        </action>
    </test>
    <test id="06-ServeBgZL-LaboratoryTestResult">
        <name value="06-ServeBgZL-LaboratoryTestResult"/>
        <description value="Test XIS Client search operation  - Serve HCIM LaboratoryTestResult and include related Observations and Specimen"/>
        <action>
            <operation>
                <type>
                    <system value="http://hl7.org/fhir/testscript-operation-codes"/>
                    <code value="search"/>
                </type>
                <resource value="Observation"/>
                <description value="Test XIS Client search operation  - Serve HCIM LaboratoryTestResult and include related Observations and Specimen"/>
                <accept value="xml"/>
                <contentType value="none"/>
                <destination value="1"/>
                <origin value="1"/>
                <params value="/$lastn?category=http://snomed.info/sct|275711006&amp;_include=Observation:related-target&amp;_include=Observation:specimen"/>
                <requestHeader>
                    <field value="Authorization"/>
                    <value value="${token-XXX-Mutter}"/>
                </requestHeader>
            </operation>
        </action>
        <action>
            <assert>
                <description value="Confirm that the client did not request a Content-Type. Warning only to allow for systems that automatically send Content-Type."/>
                <direction value="request"/>
                <headerField value="Content-Type"/>
                <operator value="empty"/>
                <warningOnly value="true"/>
            </assert>
        </action>
        <action>
            <assert>
                <description value="Confirm that HTTP header Authorization contains the patient token ${token-XXX-Mutter}"/>
                <direction value="request"/>
                <headerField value="Authorization"/>
                <value value="${token-XXX-Mutter}"/>
            </assert>
        </action>
        <action>
            <assert>
                <description value="Confirm that query parameter 'patient=' was not present to avoid BSNs in the URL."/>
                <direction value="request"/>
                <operator value="notContains"/>
                <requestURL value="patient="/>
            </assert>
        </action>
        <action>
            <assert>
                <description value="Confirm that query parameter 'subject=' was not present to avoid BSNs in the URL."/>
                <direction value="request"/>
                <operator value="notContains"/>
                <requestURL value="subject="/>
            </assert>
        </action>
        <action>
            <assert>
                <description value="Confirm that the returned HTTP status is 200(OK)."/>
                <direction value="response"/>
                <responseCode value="200"/>
            </assert>
        </action>
        <action>
            <assert>
                <description value="Confirm that the returned resource type is Bundle."/>
                <direction value="response"/>
                <resource value="Bundle"/>
            </assert>
        </action>
        <action>
            <assert>
                <description value="Confirm that the returned Bundle conforms to the base FHIR specification."/>
                <direction value="response"/>
                <validateProfileId value="Bundle-profile"/>
            </assert>
        </action>
        <action>
            <assert>
                <description value="Confirm that the returned Bundle total value matches or is less than the number of entries in the Bundle. The included resources should not be counted as entries in the .total."/>
                <direction value="response"/>
                <expression value="Bundle.total.toInteger() &lt;= Bundle.entry.where(search.empty() or search.mode = 'match').count()"/>
            </assert>
        </action>
        <action>
            <assert>
                <description value="Confirm that the returned searchset Bundle is empty, or contains an OperationOutcome as first resource or contains 5 Observation entries."/>
                <direction value="response"/>
                <expression value="Bundle.where(entry.empty() or entry[0].resource.is(OperationOutcome) or entry.where(resource.is(Observation)).count() = 5).exists()"/>
            </assert>
        </action>
    </test>
    <test id="07-ServeBgZL-Procedure">
        <name value="07-ServeBgZL-Procedure"/>
        <description value="Test XIS Client search operation  - Serve HCIM Procedure"/>
        <action>
            <operation>
                <type>
                    <system value="http://hl7.org/fhir/testscript-operation-codes"/>
                    <code value="search"/>
                </type>
                <resource value="Procedure"/>
                <description value="Test XIS Client search operation  - Serve HCIM Procedure"/>
                <accept value="xml"/>
                <contentType value="none"/>
                <destination value="1"/>
                <origin value="1"/>
                <requestHeader>
                    <field value="Authorization"/>
                    <value value="${token-XXX-Mutter}"/>
                </requestHeader>
            </operation>
        </action>
        <action>
            <assert>
                <description value="Confirm that the client did not request a Content-Type. Warning only to allow for systems that automatically send Content-Type."/>
                <direction value="request"/>
                <headerField value="Content-Type"/>
                <operator value="empty"/>
                <warningOnly value="true"/>
            </assert>
        </action>
        <action>
            <assert>
                <description value="Confirm that HTTP header Authorization contains the patient token ${token-XXX-Mutter}"/>
                <direction value="request"/>
                <headerField value="Authorization"/>
                <value value="${token-XXX-Mutter}"/>
            </assert>
        </action>
        <action>
            <assert>
                <description value="Confirm that query parameter 'patient=' was not present to avoid BSNs in the URL."/>
                <direction value="request"/>
                <operator value="notContains"/>
                <requestURL value="patient="/>
            </assert>
        </action>
        <action>
            <assert>
                <description value="Confirm that query parameter 'subject=' was not present to avoid BSNs in the URL."/>
                <direction value="request"/>
                <operator value="notContains"/>
                <requestURL value="subject="/>
            </assert>
        </action>
        <action>
            <assert>
                <description value="Confirm that the returned HTTP status is 200(OK)."/>
                <direction value="response"/>
                <responseCode value="200"/>
            </assert>
        </action>
        <action>
            <assert>
                <description value="Confirm that the returned resource type is Bundle."/>
                <direction value="response"/>
                <resource value="Bundle"/>
            </assert>
        </action>
        <action>
            <assert>
                <description value="Confirm that the returned Bundle conforms to the base FHIR specification."/>
                <direction value="response"/>
                <validateProfileId value="Bundle-profile"/>
            </assert>
        </action>
        <action>
            <assert>
                <description value="Confirm that the returned Bundle total value matches or is less than the number of entries in the Bundle. The included resources should not be counted as entries in the .total."/>
                <direction value="response"/>
                <expression value="Bundle.total.toInteger() &lt;= Bundle.entry.where(search.empty() or search.mode = 'match').count()"/>
            </assert>
        </action>
        <action>
            <assert>
                <description value="Confirm that the returned searchset Bundle is empty, or contains an OperationOutcome as first resource or contains 4 Procedure entry."/>
                <direction value="response"/>
                <expression value="Bundle.where(entry.empty() or entry[0].resource.is(OperationOutcome) or entry.where(resource.is(Procedure)).count() = 4).exists()"/>
            </assert>
        </action>
    </test>
    <test id="08-ServeBgZL-CarePlan">
        <name value="08-ServeBgZL-CarePlan"/>
        <description value="Test XIS Client search operation  - Serve HCIM NursingIntervention, TreatmentObjective, MedicalDevice and OutcomeOfCare through a Careplan"/>
        <action>
            <operation>
                <type>
                    <system value="http://hl7.org/fhir/testscript-operation-codes"/>
                    <code value="search"/>
                </type>
                <resource value="CarePlan"/>
                <description value="Test XIS Client search operation  - Serve HCIM NursingIntervention, TreatmentObjective, MedicalDevice and OutcomeOfCare through a Careplan"/>
                <accept value="xml"/>
                <contentType value="none"/>
                <destination value="1"/>
                <origin value="1"/>
                <params value="?_include=CarePlan:activity-goal:Goal&amp;_include=CarePlan:activity-outcomereference:Observation&amp;_include=CarePlan:activity-medicaldevice:DeviceUseStatement&amp;_include:recurse=DeviceUseStatement:device:Device"/>
                <requestHeader>
                    <field value="Authorization"/>
                    <value value="${token-XXX-Mutter}"/>
                </requestHeader>
            </operation>
        </action>
        <action>
            <assert>
                <description value="Confirm that the client did not request a Content-Type. Warning only to allow for systems that automatically send Content-Type."/>
                <direction value="request"/>
                <headerField value="Content-Type"/>
                <operator value="empty"/>
                <warningOnly value="true"/>
            </assert>
        </action>
        <action>
            <assert>
                <description value="Confirm that HTTP header Authorization contains the patient token ${token-XXX-Mutter}"/>
                <direction value="request"/>
                <headerField value="Authorization"/>
                <value value="${token-XXX-Mutter}"/>
            </assert>
        </action>
        <action>
            <assert>
                <description value="Confirm that query parameter 'patient=' was not present to avoid BSNs in the URL."/>
                <direction value="request"/>
                <operator value="notContains"/>
                <requestURL value="patient="/>
            </assert>
        </action>
        <action>
            <assert>
                <description value="Confirm that query parameter 'subject=' was not present to avoid BSNs in the URL."/>
                <direction value="request"/>
                <operator value="notContains"/>
                <requestURL value="subject="/>
            </assert>
        </action>
        <action>
            <assert>
                <description value="Confirm that the returned HTTP status is 200(OK)."/>
                <direction value="response"/>
                <responseCode value="200"/>
            </assert>
        </action>
        <action>
            <assert>
                <description value="Confirm that the returned resource type is Bundle."/>
                <direction value="response"/>
                <resource value="Bundle"/>
            </assert>
        </action>
        <action>
            <assert>
                <description value="Confirm that the returned Bundle conforms to the base FHIR specification."/>
                <direction value="response"/>
                <validateProfileId value="Bundle-profile"/>
            </assert>
        </action>
        <action>
            <assert>
                <description value="Confirm that the returned Bundle total value matches or is less than the number of entries in the Bundle. The included resources should not be counted as entries in the .total."/>
                <direction value="response"/>
                <expression value="Bundle.total.toInteger() &lt;= Bundle.entry.where(search.empty() or search.mode = 'match').count()"/>
            </assert>
        </action>
        <action>
            <assert>
                <!-- TO DO: improve the expression to count included resources -->
                <description value="Confirm that the returned searchset Bundle is empty, or contains an OperationOutcome as first resource or contains 1 CarePlan entry."/>
                <direction value="response"/>
                <expression value="Bundle.where(entry.empty() or entry[0].resource.is(OperationOutcome) or entry.where(resource.is(CarePlan)).count() = 1).exists()"/>
            </assert>
        </action>
    </test>
    <test id="09-ServeBgZL-CareTeam">
        <name value="09-ServeBgZL-CareTeam"/>
        <description value="Test XIS Client search operation  - Serve HCIM HealthProfessional and HealthcareProvider through a CareTeam"/>
        <action>
            <operation>
                <type>
                    <system value="http://hl7.org/fhir/testscript-operation-codes"/>
                    <code value="search"/>
                </type>
                <resource value="CareTeam"/>
                <description value="Test XIS Client search operation  - Serve HCIM HealthProfessional and HealthcareProvider through a CareTeam"/>
                <accept value="xml"/>
                <contentType value="none"/>
                <destination value="1"/>
                <origin value="1"/>
                <params value="?_include=CareTeam:participant"/>
                <requestHeader>
                    <field value="Authorization"/>
                    <value value="${token-XXX-Mutter}"/>
                </requestHeader>
            </operation>
        </action>
        <action>
            <assert>
                <description value="Confirm that the client did not request a Content-Type. Warning only to allow for systems that automatically send Content-Type."/>
                <direction value="request"/>
                <headerField value="Content-Type"/>
                <operator value="empty"/>
                <warningOnly value="true"/>
            </assert>
        </action>
        <action>
            <assert>
                <description value="Confirm that HTTP header Authorization contains the patient token ${token-XXX-Mutter}"/>
                <direction value="request"/>
                <headerField value="Authorization"/>
                <value value="${token-XXX-Mutter}"/>
            </assert>
        </action>
        <action>
            <assert>
                <description value="Confirm that query parameter 'patient=' was not present to avoid BSNs in the URL."/>
                <direction value="request"/>
                <operator value="notContains"/>
                <requestURL value="patient="/>
            </assert>
        </action>
        <action>
            <assert>
                <description value="Confirm that query parameter 'subject=' was not present to avoid BSNs in the URL."/>
                <direction value="request"/>
                <operator value="notContains"/>
                <requestURL value="subject="/>
            </assert>
        </action>
        <action>
            <assert>
                <description value="Confirm that the returned HTTP status is 200(OK)."/>
                <direction value="response"/>
                <responseCode value="200"/>
            </assert>
        </action>
        <action>
            <assert>
                <description value="Confirm that the returned resource type is Bundle."/>
                <direction value="response"/>
                <resource value="Bundle"/>
            </assert>
        </action>
        <action>
            <assert>
                <description value="Confirm that the returned Bundle conforms to the base FHIR specification."/>
                <direction value="response"/>
                <validateProfileId value="Bundle-profile"/>
            </assert>
        </action>
        <action>
            <assert>
                <description value="Confirm that the returned Bundle total value matches or is less than the number of entries in the Bundle. The included resources should not be counted as entries in the .total."/>
                <direction value="response"/>
                <expression value="Bundle.total.toInteger() &lt;= Bundle.entry.where(search.empty() or search.mode = 'match').count()"/>
            </assert>
        </action>
        <action>
            <assert>
                <!-- TO DO: improve the expression to count included resources -->
                <description value="Confirm that the returned searchset Bundle is empty, or contains an OperationOutcome as first resource or contains 1 CareTeam entry."/>
                <direction value="response"/>
                <expression value="Bundle.where(entry.empty() or entry[0].resource.is(OperationOutcome) or entry.where(resource.is(CareTeam)).count() = 1).exists()"/>
            </assert>
        </action>
    </test>
</TestScript>
